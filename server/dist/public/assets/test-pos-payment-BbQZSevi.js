import{aG as he,u as ue,bu as je,r as n,j as e,_ as pe,ap as v,B as r,F as Ne,K as X,a as O,b as U,d as _,aP as d,e as $,T as ge,i as be,k as y,M as Q,n as w,bw as fe,C as G,$ as C,I as S,al as W,am as H,ao as K,bx as ve,ba as J,X as Y,x as ye,by as Z,aL as we,bz as Ce}from"./index-Bdt7aQY8.js";import{S as ee,P as se,I as Se}from"./IdentityVerification-CHyRbnlX.js";import{L as Te}from"./scan-C9uXCfh4.js";const T="TEST-XP001",ke=()=>{const{toast:o}=he(),[Pe,ae]=ue(),{user:g}=je(),[te,c]=n.useState("services"),[t,u]=n.useState([]),[a,j]=n.useState({name:"",email:"",document:""}),[P,I]=n.useState(!1),[re,L]=n.useState(!1),[E,k]=n.useState(null),[A,x]=n.useState(null),[V,m]=n.useState("idle"),[p,R]=n.useState("disconnected"),[le,ne]=n.useState(!1),[h,ie]=n.useState(null),N=t.reduce((s,l)=>s+l.price*l.quantity,0),b=N*se.TAX_RATE,M=N+b,z=N.toLocaleString("es-CL",{style:"currency",currency:"CLP"}),B=b.toLocaleString("es-CL",{style:"currency",currency:"CLP"}),f=M.toLocaleString("es-CL",{style:"currency",currency:"CLP"});n.useEffect(()=>{const s=()=>{R("disconnected"),setTimeout(()=>{R("connected"),o({title:"Terminal conectado",description:"Terminal de prueba listo para usar"})},2e3)};s();const l=setInterval(s,6e4);return()=>clearInterval(l)},[]);const ce=s=>{const l=t.find(i=>i.id===s.id);u(l?t.map(i=>i.id===s.id?{...i,quantity:i.quantity+1}:i):[...t,{...s,quantity:1}]),o({title:"Servicio agregado",description:`${s.name} agregado al carrito`})},D=s=>{u(t.filter(l=>l.id!==s))},q=(s,l)=>{if(l<=0){D(s);return}u(t.map(i=>i.id===s?{...i,quantity:l}:i))},de=async()=>{if(t.length===0){x("No hay items en el carrito");return}if(!a.name||!a.email){x("Por favor complete la información del cliente"),c("customer");return}if(p!=="connected"){x("Terminal de pago no disponible");return}I(!0),x(null),m("connecting");try{setTimeout(()=>m("waiting"),1e3),setTimeout(()=>m("processing"),3e3),await new Promise(l=>setTimeout(l,5e3));const s="TX-TEST-"+Date.now().toString().slice(-6);k(s),m("success"),L(!0),o({title:"Pago completado (PRUEBA)",description:`Transacción ${s} procesada exitosamente`}),console.log("Transacción simulada registrada:",{id:s,storeCode:T,items:t,customer:a,total:M,subtotal:N,tax:b,operatorId:(g==null?void 0:g.id)||"unknown",timestamp:new Date().toISOString(),testMode:!0})}catch(s){console.error("Error procesando el pago:",s),x("Error al procesar el pago. Intente nuevamente."),m("failure"),o({title:"Error",description:"No se pudo completar la transacción",variant:"destructive"})}finally{I(!1)}},F=()=>{u([]),j({name:"",email:"",document:""}),L(!1),k(null),x(null),m("idle"),c("services")},oe=()=>e.jsxs("div",{className:"bg-white p-6 rounded-lg border",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-xs inline-block mb-2",children:"MODO PRUEBA"}),e.jsx("h3",{className:"text-xl font-bold",children:"Recibo de Pago"}),e.jsx("p",{className:"text-gray-500",children:"VecinoXpress"}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Tienda: ",T]}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Transacción #",E]}),e.jsx("p",{className:"text-sm text-gray-400",children:new Date().toLocaleString()})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Cliente"}),e.jsx("p",{children:a.name}),e.jsx("p",{className:"text-sm text-gray-500",children:a.email}),a.document&&e.jsxs("p",{className:"text-sm text-gray-500",children:["RUT: ",a.document]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Items"}),t.map(s=>e.jsxs("div",{className:"flex justify-between py-1 text-sm",children:[e.jsxs("span",{children:[s.quantity," x ",s.name]}),e.jsx("span",{children:(s.price*s.quantity).toLocaleString("es-CL",{style:"currency",currency:"CLP"})})]},s.id))]}),e.jsx(Y,{className:"my-4"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:z})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"IVA (19%)"}),e.jsx("span",{children:B})]}),e.jsxs("div",{className:"flex justify-between font-bold mt-2",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:f})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t text-center",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center mb-4",children:[e.jsx(v,{className:"w-10 h-10 text-green-500 mb-2"}),e.jsx("p",{className:"text-green-600 font-medium",children:"Pago Completado (Simulación)"})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Gracias por utilizar VecinoXpress"})]})]}),me=()=>{switch(p){case"connected":return e.jsxs(d,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Terminal simulado conectado"]});case"disconnected":return e.jsxs(d,{variant:"outline",className:"bg-gray-50 text-gray-700 border-gray-200",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Terminal desconectado"]});case"error":return e.jsxs(d,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:[e.jsx(H,{className:"w-3 h-3 mr-1"}),"Error en terminal"]});default:return null}},xe=()=>{switch(V){case"connecting":return e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"animate-spin w-10 h-10 border-4 border-[#2d219b] border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Conectando con terminal de prueba..."})]});case"waiting":return e.jsxs("div",{className:"text-center py-6",children:[e.jsx(Ce,{className:"w-10 h-10 mx-auto mb-4 text-[#2d219b]"}),e.jsx("p",{className:"text-gray-600 font-medium mb-2",children:"Esperando pago en terminal simulado"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Este es un terminal simulado para pruebas"})]});case"processing":return e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"animate-spin w-10 h-10 border-4 border-[#2d219b] border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium mb-2",children:"Procesando pago (simulación)"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Por favor espere mientras se completa la transacción"})]});case"failure":return e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(J,{className:"w-6 h-6 text-red-600"})}),e.jsx("p",{className:"text-red-600 font-medium mb-2",children:"Error en la transacción"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No se pudo completar el pago. Por favor intente nuevamente."}),e.jsx(r,{onClick:()=>m("idle"),className:"mt-4",children:"Intentar de nuevo"})]});default:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(W,{variant:"default",className:"bg-yellow-50 border-yellow-200",children:[e.jsx(we,{className:"h-4 w-4 text-yellow-600"}),e.jsx(K,{className:"text-yellow-700",children:"Este es un entorno de prueba. No se realizarán cargos reales."})]}),e.jsxs("div",{className:"bg-[#2d219b]/5 p-4 rounded-lg border border-[#2d219b]/10",children:[e.jsx("h3",{className:"font-medium text-[#2d219b] mb-2",children:"Terminal de pago simulado"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Este modo simula un terminal de pagos para probar el sistema:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(d,{variant:"outline",children:"Tarjeta de prueba"}),e.jsx(d,{variant:"outline",children:"Sin cargos reales"}),e.jsx(d,{variant:"outline",children:"Simulación de QR"}),e.jsx(d,{variant:"outline",children:"Probar flujo completo"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold mb-2",children:f}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Total a pagar (simulado)"}),e.jsxs(r,{size:"lg",className:"w-full",onClick:de,disabled:P||p!=="connected",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Simular pago con terminal"]}),p!=="connected"&&e.jsx("p",{className:"text-sm text-red-500 mt-2",children:"El terminal simulado no está disponible"})]})]})}};return e.jsx("div",{className:"min-h-screen bg-gray-50 p-4 md:p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>ae("/"),className:"mr-4 flex items-center justify-center w-10 h-10 rounded-full bg-white shadow hover:bg-gray-100",children:e.jsx(pe,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-2xl font-bold text-[#2d219b]",children:"VecinoXpress POS"})]}),e.jsxs("div",{className:"flex gap-2",children:[me(),e.jsx("div",{className:"text-sm bg-yellow-500 text-white px-3 py-1 rounded-full",children:"Modo PRUEBA"})]})]}),re?e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 bg-white p-6 rounded-lg shadow text-center mb-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(v,{className:"w-8 h-8 text-green-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-green-700 mb-2",children:"¡Transacción de Prueba Completada!"}),e.jsxs("div",{className:"text-gray-600 mb-6",children:[e.jsxs("p",{children:["La transacción #",E," ha sido procesada exitosamente."]}),e.jsx("p",{className:"text-sm mt-2",children:e.jsx("em",{children:"Nota: Esta es una transacción de prueba. No se han realizado cargos reales."})})]}),e.jsx(r,{onClick:F,children:"Nueva Transacción"})]}),e.jsx("div",{className:"col-span-1",children:oe()}),e.jsxs("div",{className:"col-span-1 bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"¿Qué desea hacer ahora?"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(r,{variant:"outline",className:"w-full justify-start text-left",onClick:()=>{o({title:"Imprimir recibo (simulado)",description:"Simulación de impresión completada"})},children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Imprimir recibo (simulado)"]}),e.jsxs(r,{variant:"outline",className:"w-full justify-start text-left",onClick:()=>{o({title:"Enviar por correo (simulado)",description:`Simulación de envío a ${a.email}`})},children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Enviar por correo (simulado)"]}),e.jsxs(r,{className:"w-full justify-start text-left",onClick:F,children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Nueva venta"]})]})]})]}):e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs(O,{className:"shadow",children:[e.jsx(U,{className:"bg-gradient-to-r from-[#2d219b]/10 to-[#2d219b]/5",children:e.jsxs(_,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Terminal de Servicios (PRUEBA)"}),e.jsxs(d,{variant:"outline",className:"bg-white",children:["Tienda: ",T]})]})}),e.jsx($,{className:"p-0",children:e.jsxs(ge,{value:te,onValueChange:c,className:"w-full",children:[e.jsxs(be,{className:"w-full grid grid-cols-3",children:[e.jsxs(y,{value:"services",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Servicios"]}),e.jsxs(y,{value:"customer",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Cliente"]}),e.jsxs(y,{value:"payment",disabled:t.length===0,children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Pago"]})]}),e.jsxs(w,{value:"services",className:"p-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Seleccione los servicios"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:se.AVAILABLE_SERVICES.map(s=>e.jsx("div",{className:"border rounded-lg p-3 hover:bg-gray-50 cursor-pointer",onClick:()=>ce(s),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.price.toLocaleString("es-CL",{style:"currency",currency:"CLP"})})]}),e.jsx(r,{size:"sm",variant:"ghost",children:e.jsx(fe,{className:"w-4 h-4"})})]})},s.id))}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsxs(r,{disabled:t.length===0,onClick:()=>c("customer"),children:["Siguiente",e.jsx(G,{className:"ml-2 h-4 w-4"})]})})]}),e.jsxs(w,{value:"customer",className:"p-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Información del cliente"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(C,{htmlFor:"name",children:"Nombre completo"}),e.jsx(S,{id:"name",value:a.name,onChange:s=>j({...a,name:s.target.value}),placeholder:"Nombre del cliente"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(C,{htmlFor:"email",children:"Correo electrónico"}),e.jsx(S,{id:"email",type:"email",value:a.email,onChange:s=>j({...a,email:s.target.value}),placeholder:"correo@ejemplo.com"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(C,{htmlFor:"document",children:"RUT (opcional)"}),e.jsx(S,{id:"document",value:a.document,onChange:s=>j({...a,document:s.target.value}),placeholder:"12.345.678-9"})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Verificación de Identidad"}),le?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 flex items-start",children:[e.jsx(v,{className:"text-green-600 w-5 h-5 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800",children:"Identidad Verificada"}),h&&e.jsxs("div",{className:"mt-2 text-sm text-green-700",children:[e.jsxs("p",{children:["Nombre: ",h.fullName]}),e.jsxs("p",{children:["Documento: ",h.documentNumber]}),e.jsxs("p",{children:["Método: ",h.verificationMethod==="simulate"?"Simulado":h.verificationMethod==="nfc"?"NFC":h.verificationMethod==="document"?"Documento":"Selfie"]})]})]})]}):e.jsx(Se,{onVerificationComplete:s=>{ne(!0),ie(s),j({...a,name:s.fullName,document:s.documentNumber}),o({title:"Identidad verificada",description:"La información ha sido verificada exitosamente."})},mode:"simple"})]}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx(r,{variant:"outline",onClick:()=>c("services"),children:"Atrás"}),e.jsxs(r,{onClick:()=>c("payment"),disabled:!a.name||!a.email,children:["Siguiente",e.jsx(G,{className:"ml-2 h-4 w-4"})]})]})]}),e.jsxs(w,{value:"payment",className:"p-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Pago con terminal simulado"}),xe(),A&&e.jsxs(W,{variant:"destructive",className:"mt-4",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx(K,{children:A})]}),V==="idle"&&e.jsx("div",{className:"mt-6 flex justify-between",children:e.jsx(r,{variant:"outline",onClick:()=>c("customer"),children:"Atrás"})})]})]})})]})}),e.jsx("div",{className:"col-span-1",children:e.jsxs(O,{className:"shadow",children:[e.jsx(U,{className:"bg-gradient-to-r from-[#2d219b]/10 to-[#2d219b]/5 pb-4",children:e.jsxs(_,{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Carrito"}),e.jsxs("span",{className:"text-sm bg-[#2d219b] text-white px-2 py-1 rounded",children:[t.length," ítems"]})]})}),e.jsxs($,{className:"p-0",children:[e.jsx(ve,{className:"h-[400px]",children:e.jsx("div",{className:"p-4",children:t.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ee,{className:"w-10 h-10 mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"El carrito está vacío"})]}):e.jsx("div",{className:"space-y-2",children:t.map(s=>e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.price.toLocaleString("es-CL",{style:"currency",currency:"CLP"})})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(r,{size:"sm",variant:"outline",className:"h-7 w-7 p-0",onClick:()=>q(s.id,s.quantity-1),children:"-"}),e.jsx("span",{className:"w-5 text-center",children:s.quantity}),e.jsx(r,{size:"sm",variant:"outline",className:"h-7 w-7 p-0",onClick:()=>q(s.id,s.quantity+1),children:"+"})]}),e.jsx(r,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-gray-400",onClick:()=>D(s.id),children:e.jsx(J,{className:"h-4 w-4"})})]})]},s.id))})})}),e.jsx("div",{className:"p-4 border-t bg-gray-50",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsx("span",{children:z})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"IVA (19%)"}),e.jsx("span",{children:B})]}),e.jsx(Y,{className:"my-2"}),e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:f})]})]})})]}),e.jsx(ye,{className:"border-t p-4",children:e.jsx(r,{className:"w-full",disabled:t.length===0||P,onClick:()=>c("payment"),children:t.length===0?"Agregue servicios":"Proceder al pago"})})]})})]})]})})};export{ke as default};
