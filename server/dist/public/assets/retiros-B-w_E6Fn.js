import{u as ee,r as i,H as k,ac as $,g as se,h as ae,j as e,B as l,_ as te,a as P,e as R,al as T,am as h,an as V,ao as E,b as re,d as ne,f as ie,a5 as oe,aa as le,C as ce,ar as z,as as M,at as W,au as I,av as H,ap as O,o as de,p as j,q as b,s as p,t as f,I as K,W as ue,w as g,ag as me,aw as xe,a4 as he,X as je,y as be,ax as pe,z as L,ay as fe,A as ge,G as D,aq as G}from"./index-Bdt7aQY8.js";const Ne=be({amount:pe({required_error:"Monto requerido",invalid_type_error:"Debe ser un número"}).min(5e3,"El monto mínimo de retiro es $5.000"),bankName:L().min(1,"Selecciona un banco"),accountType:L().min(1,"Selecciona un tipo de cuenta"),accountNumber:L().min(5,"El número de cuenta es requerido")});function _(r){const c=new Date(r);return new Intl.DateTimeFormat("es-CL",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(c)}function ve(r){switch(r){case"cuenta_corriente":return"Cuenta Corriente";case"cuenta_vista":return"Cuenta Vista / RUT";case"cuenta_ahorro":return"Cuenta de Ahorro";default:return r}}function ye(r){switch(r){case"banco_estado":return"Banco Estado";case"banco_santander":return"Banco Santander";case"banco_chile":return"Banco de Chile";case"banco_bci":return"Banco BCI";case"banco_scotiabank":return"Scotiabank";default:return r}}function Q(r){switch(r){case"completed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}function Se(){var A,B;const[r,c]=ee(),[u,o]=i.useState(!1),[d,y]=i.useState(!1),[t,U]=i.useState(null),[F,x]=i.useState("idle");i.useEffect(()=>{localStorage.getItem("vecinos_token")||(c("/vecinos/login"),k({title:"Sesión no válida",description:"Por favor inicia sesión para acceder",variant:"destructive"}))},[c]);const{data:a}=$({queryKey:["/api/vecinos/partner-info"],queryFn:async()=>{const s=await D("GET","/api/vecinos/partner-info");if(!s.ok)throw new Error("Error al obtener información");return await s.json()}}),{data:w,isLoading:X}=$({queryKey:["/api/vecinos/withdrawal-requests"],queryFn:async()=>{try{const s=await D("GET","/api/vecinos/withdrawal-requests");if(!s.ok)throw new Error("Error al obtener historial de retiros");return await s.json()}catch(s){return console.error("Error fetching withdrawal requests:",s),[]}}}),n=se({resolver:ge(Ne),defaultValues:{amount:void 0,bankName:"",accountType:"",accountNumber:""}});i.useEffect(()=>{a&&(n.setValue("bankName",a.bankName||""),n.setValue("accountType",a.accountType||""),n.setValue("accountNumber",a.accountNumber||""))},[a,n]);const C=ae({mutationFn:async s=>{const m=await D("POST","/api/vecinos/withdrawal-request",s);if(!m.ok){const S=await m.json();throw new Error(S.message||"Error al solicitar retiro")}return await m.json()},onSuccess:s=>{G.invalidateQueries({queryKey:["/api/vecinos/partner-info"]}),G.invalidateQueries({queryKey:["/api/vecinos/withdrawal-requests"]}),x("success"),n.reset({amount:void 0,bankName:(a==null?void 0:a.bankName)||"",accountType:(a==null?void 0:a.accountType)||"",accountNumber:(a==null?void 0:a.accountNumber)||""})},onError:s=>{x("error"),k({title:"Error al solicitar retiro",description:s.message,variant:"destructive"})}}),J=s=>{if(a&&a.balance<s.amount){k({title:"Saldo insuficiente",description:`Tu saldo actual es $${a.balance.toLocaleString("es-CL")}`,variant:"destructive"});return}C.mutate(s)},Y=s=>{U(s),y(!0)},Z=s=>{switch(s){case"completed":return"Tu retiro ha sido procesado y transferido a tu cuenta bancaria.";case"pending":return"Tu solicitud está siendo procesada. Los fondos se transferirán en 1-3 días hábiles.";case"rejected":return"Tu solicitud fue rechazada. Por favor, contacta a soporte para más información.";default:return"Estado desconocido. Por favor, contacta a soporte."}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-blue-600 text-white",children:e.jsx("div",{className:"container mx-auto px-4 py-4 flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs(l,{variant:"ghost",className:"text-white hover:bg-blue-700 mr-2",onClick:()=>c("/vecinos/dashboard"),children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Volver"]}),e.jsx("h1",{className:"text-xl font-bold",children:"Retiro de Comisiones"})]})})}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx(P,{className:"mb-8 bg-blue-50 border-blue-200",children:e.jsxs(R,{className:"pt-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-800",children:"Saldo disponible"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-600",children:["$",((A=a==null?void 0:a.balance)==null?void 0:A.toLocaleString("es-CL"))||"0"]})]}),e.jsx(l,{className:"bg-blue-600 hover:bg-blue-700",onClick:()=>o(!0),disabled:!a||a.balance<5e3,children:"Solicitar retiro"})]}),(!a||a.balance<5e3)&&e.jsxs(T,{className:"mt-4 bg-yellow-50 border-yellow-200",children:[e.jsx(h,{className:"h-4 w-4 text-yellow-600"}),e.jsx(V,{className:"text-yellow-600",children:"Saldo insuficiente"}),e.jsx(E,{children:"El monto mínimo para solicitar un retiro es de $5.000 CLP."})]})]})}),e.jsxs(P,{children:[e.jsxs(re,{children:[e.jsx(ne,{children:"Historial de retiros"}),e.jsx(ie,{children:"Revisa el estado de tus solicitudes de retiro"})]}),e.jsx(R,{children:X?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-500",children:"Cargando historial de retiros..."})]}):w&&w.length>0?e.jsx("div",{className:"space-y-4",children:w.map(s=>e.jsx("div",{className:"border rounded-lg p-4 hover:shadow-sm transition-shadow cursor-pointer",onClick:()=>Y(s),children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(oe,{className:"h-5 w-5 text-blue-600 mr-1"}),e.jsxs("span",{className:"font-semibold",children:["$",s.amount.toLocaleString("es-CL")]})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-1",children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:["Solicitado: ",_(s.createdAt)]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Q(s.status)}`,children:s.status==="completed"?"Completado":s.status==="pending"?"Pendiente":s.status==="rejected"?"Rechazado":s.status}),e.jsx(ce,{className:"h-5 w-5 text-gray-400 ml-2"})]})]})},s.id))}):e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("p",{className:"text-gray-500",children:"No has realizado ninguna solicitud de retiro."}),e.jsx(l,{variant:"outline",className:"mt-4",onClick:()=>o(!0),disabled:!a||a.balance<5e3,children:"Solicitar tu primer retiro"})]})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Información importante"}),e.jsxs(we,{type:"single",collapsible:!0,className:"w-full",children:[e.jsxs(q,{value:"item-1",children:[e.jsx(N,{children:"¿Cuándo se procesan las solicitudes de retiro?"}),e.jsx(v,{children:"Las solicitudes de retiro se procesan dentro de 1-3 días hábiles. Los fondos se transferirán a la cuenta bancaria registrada en tu perfil."})]}),e.jsxs(q,{value:"item-2",children:[e.jsx(N,{children:"¿Hay un monto mínimo para solicitar un retiro?"}),e.jsx(v,{children:"Sí, el monto mínimo para solicitar un retiro es de $5.000 CLP. No hay límite en la cantidad de retiros que puedes solicitar por mes."})]}),e.jsxs(q,{value:"item-3",children:[e.jsx(N,{children:"¿Cómo actualizo mis datos bancarios?"}),e.jsx(v,{children:'Puedes actualizar tus datos bancarios en la sección "Mi Cuenta" > "Datos bancarios". Los cambios se aplicarán a todas las solicitudes de retiro futuras.'})]})]})]})]})}),e.jsx(z,{open:u,onOpenChange:o,children:e.jsxs(M,{className:"max-w-md",children:[e.jsxs(W,{children:[e.jsx(I,{children:"Solicitar retiro"}),e.jsx(H,{children:"Ingresa los datos para transferir tus comisiones"})]}),F==="success"?e.jsxs("div",{className:"py-6 text-center space-y-4",children:[e.jsx(O,{className:"h-12 w-12 text-green-600 mx-auto"}),e.jsx("h3",{className:"text-xl font-bold",children:"¡Solicitud enviada!"}),e.jsx("p",{className:"text-gray-600",children:"Tu solicitud de retiro ha sido recibida y será procesada en los próximos 1-3 días hábiles."}),e.jsx(l,{className:"w-full bg-blue-600 hover:bg-blue-700 mt-4",onClick:()=>{x("idle"),o(!1)},children:"Entendido"})]}):F==="error"?e.jsxs("div",{className:"py-6 text-center space-y-4",children:[e.jsx(h,{className:"h-12 w-12 text-red-600 mx-auto"}),e.jsx("h3",{className:"text-xl font-bold",children:"Error en la solicitud"}),e.jsx("p",{className:"text-gray-600",children:"Ha ocurrido un error al procesar tu solicitud. Por favor, intenta nuevamente."}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(l,{variant:"outline",className:"w-full",onClick:()=>x("idle"),children:"Intentar nuevamente"}),e.jsx(l,{className:"w-full bg-blue-600 hover:bg-blue-700",onClick:()=>{x("idle"),o(!1)},children:"Cerrar"})]})]}):e.jsx(de,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(J),className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Saldo disponible:"}),e.jsxs("p",{className:"font-bold text-lg text-blue-600",children:["$",((B=a==null?void 0:a.balance)==null?void 0:B.toLocaleString("es-CL"))||"0"]})]}),e.jsx(l,{type:"button",variant:"outline",size:"sm",onClick:()=>{a&&n.setValue("amount",a.balance)},disabled:!a||a.balance<5e3,children:"Retirar todo"})]}),e.jsx(j,{control:n.control,name:"amount",render:({field:s})=>e.jsxs(b,{children:[e.jsx(p,{children:"Monto a retirar"}),e.jsx(f,{children:e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"$"}),e.jsx(K,{type:"number",placeholder:"5000",className:"pl-8",...s,onChange:m=>{const S=m.target.value===""?void 0:Number(m.target.value);s.onChange(S)}})]})}),e.jsx(ue,{children:"Monto mínimo: $5.000 CLP"}),e.jsx(g,{})]})}),e.jsx(j,{control:n.control,name:"bankName",render:({field:s})=>e.jsxs(b,{children:[e.jsx(p,{children:"Banco"}),e.jsx(f,{children:e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",...s,children:[e.jsx("option",{value:"",children:"Seleccionar banco"}),e.jsx("option",{value:"banco_estado",children:"Banco Estado"}),e.jsx("option",{value:"banco_santander",children:"Banco Santander"}),e.jsx("option",{value:"banco_chile",children:"Banco de Chile"}),e.jsx("option",{value:"banco_bci",children:"Banco BCI"}),e.jsx("option",{value:"banco_scotiabank",children:"Scotiabank"}),e.jsx("option",{value:"otro",children:"Otro"})]})}),e.jsx(g,{})]})}),e.jsx(j,{control:n.control,name:"accountType",render:({field:s})=>e.jsxs(b,{children:[e.jsx(p,{children:"Tipo de cuenta"}),e.jsx(f,{children:e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",...s,children:[e.jsx("option",{value:"",children:"Seleccionar tipo de cuenta"}),e.jsx("option",{value:"cuenta_corriente",children:"Cuenta Corriente"}),e.jsx("option",{value:"cuenta_vista",children:"Cuenta Vista / RUT"}),e.jsx("option",{value:"cuenta_ahorro",children:"Cuenta de Ahorro"})]})}),e.jsx(g,{})]})}),e.jsx(j,{control:n.control,name:"accountNumber",render:({field:s})=>e.jsxs(b,{children:[e.jsx(p,{children:"Número de cuenta"}),e.jsx(f,{children:e.jsx(K,{...s})}),e.jsx(g,{})]})}),e.jsxs(T,{className:"bg-blue-50 border-blue-200",children:[e.jsx(me,{className:"h-4 w-4 text-blue-600"}),e.jsx(V,{className:"text-blue-600",children:"Información de pago"}),e.jsx(E,{children:"Tus comisiones serán transferidas a esta cuenta bancaria en un plazo de 1-3 días hábiles."})]}),e.jsxs(xe,{className:"pt-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>o(!1),children:"Cancelar"}),e.jsx(l,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",disabled:C.isPending,children:C.isPending?"Procesando...":"Solicitar retiro"})]})]})})]})}),e.jsx(z,{open:d,onOpenChange:y,children:e.jsxs(M,{className:"max-w-md",children:[e.jsxs(W,{children:[e.jsx(I,{children:"Detalles del retiro"}),e.jsx(H,{children:"Información detallada sobre tu solicitud"})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Monto solicitado"}),e.jsxs("span",{className:"text-xl font-bold",children:["$",t.amount.toLocaleString("es-CL")]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Estado:"}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${Q(t.status)}`,children:t.status==="completed"?"Completado":t.status==="pending"?"Pendiente":t.status==="rejected"?"Rechazado":t.status})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Fecha de solicitud:"}),e.jsx("span",{children:_(t.createdAt)})]}),t.processedAt&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Fecha de procesamiento:"}),e.jsx("span",{children:_(t.processedAt)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"ID de solicitud:"}),e.jsx("span",{className:"font-mono",children:t.id})]})]}),e.jsxs(T,{className:`mt-4 ${t.status==="completed"?"bg-green-50 border-green-200":t.status==="pending"?"bg-yellow-50 border-yellow-200":t.status==="rejected"?"bg-red-50 border-red-200":"bg-gray-50 border-gray-200"}`,children:[e.jsx("div",{className:`h-4 w-4 ${t.status==="completed"?"text-green-600":t.status==="pending"?"text-yellow-600":t.status==="rejected"?"text-red-600":"text-gray-600"}`,children:t.status==="completed"?e.jsx(O,{className:"h-4 w-4"}):t.status==="pending"?e.jsx(he,{className:"h-4 w-4"}):t.status==="rejected"?e.jsx(h,{className:"h-4 w-4"}):e.jsx(h,{className:"h-4 w-4"})}),e.jsx(E,{children:Z(t.status)})]})]}),e.jsx(je,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Información bancaria"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Banco:"}),e.jsx("span",{children:ye(t.bankName)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tipo de cuenta:"}),e.jsx("span",{children:ve(t.accountType)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Número de cuenta:"}),e.jsx("span",{className:"font-mono",children:t.accountNumber})]})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(l,{className:"bg-blue-600 hover:bg-blue-700",onClick:()=>y(!1),children:"Cerrar"})})]})]})})]})}function we({children:r,type:c,collapsible:u,className:o}){return e.jsx("div",{className:o,children:r})}function q({children:r,value:c}){const[u,o]=i.useState(!1);return e.jsx("div",{className:"border-b",children:i.Children.map(r,d=>i.isValidElement(d)&&d.type===N?i.cloneElement(d,{onClick:()=>o(!u),isOpen:u}):i.isValidElement(d)&&d.type===v?u?d:null:d)})}function N({children:r,isOpen:c,onClick:u}){return e.jsxs("div",{className:"flex justify-between items-center py-4 font-medium cursor-pointer hover:underline",onClick:u,children:[r,e.jsx(fe,{className:`h-4 w-4 transition-transform ${c?"transform rotate-180":""}`})]})}function v({children:r}){return e.jsx("div",{className:"pb-4 pt-0 text-gray-600",children:r})}export{Se as default};
