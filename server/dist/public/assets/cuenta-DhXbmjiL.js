import{u as re,r as g,H as x,ac as ne,g as E,h as S,j as e,B as h,_ as te,ad as oe,ae as ie,af as ce,T as le,i as de,k as T,n as z,a as I,b as A,d as F,f as q,e as B,o as L,p as r,q as n,s as t,t as o,ag as me,I as d,w as i,K as ue,ah as xe,ai as he,aj as R,ak as _,E as Q,X as je,al as D,am as $,an as V,ao as G,ap as be,aq as M,y as H,z as c,A as U,G as y}from"./index-Bdt7aQY8.js";import{E as O}from"./eye-off-CbdfjWsg.js";const fe=H({storeName:c().min(3,"El nombre debe tener al menos 3 caracteres"),ownerName:c().min(3,"El nombre debe tener al menos 3 caracteres"),email:c().email("Correo electrónico inválido"),phone:c().min(8,"El teléfono debe tener al menos 8 dígitos"),address:c().min(5,"La dirección debe tener al menos 5 caracteres"),city:c().min(2,"La ciudad es requerida")}),pe=H({currentPassword:c().min(1,"La contraseña actual es requerida"),newPassword:c().min(8,"La nueva contraseña debe tener al menos 8 caracteres"),confirmPassword:c().min(1,"Confirma tu nueva contraseña")}).refine(p=>p.newPassword===p.confirmPassword,{message:"Las contraseñas no coinciden",path:["confirmPassword"]}),we=H({bankName:c().min(1,"Selecciona un banco"),accountType:c().min(1,"Selecciona un tipo de cuenta"),accountNumber:c().min(5,"El número de cuenta es requerido"),ownerRut:c().min(8,"RUT inválido")});function Ne(){var K;const[p,w]=re(),[j,N]=g.useState(!1),[b,J]=g.useState(!1),[W,Y]=g.useState("general");g.useEffect(()=>{localStorage.getItem("vecinos_token")||(w("/vecinos/login"),x({title:"Sesión no válida",description:"Por favor inicia sesión para acceder",variant:"destructive"}))},[w]);const{data:s,isLoading:Z}=ne({queryKey:["/api/vecinos/partner-info"],queryFn:async()=>{const a=await y("GET","/api/vecinos/partner-info");if(!a.ok)throw new Error("Error al obtener información");return await a.json()}}),m=E({resolver:U(fe),defaultValues:{storeName:"",ownerName:"",email:"",phone:"",address:"",city:""}}),f=E({resolver:U(pe),defaultValues:{currentPassword:"",newPassword:"",confirmPassword:""}}),u=E({resolver:U(we),defaultValues:{bankName:"",accountType:"",accountNumber:"",ownerRut:""}});g.useEffect(()=>{s&&(m.reset({storeName:s.storeName||"",ownerName:s.ownerName||"",email:s.email||"",phone:s.phone||"",address:s.address||"",city:s.city||""}),u.reset({bankName:s.bankName||"",accountType:s.accountType||"",accountNumber:s.accountNumber||"",ownerRut:s.ownerRut||""}))},[s]);const C=S({mutationFn:async a=>{const l=await y("PATCH","/api/vecinos/account/general",a);if(!l.ok){const v=await l.json();throw new Error(v.message||"Error al actualizar información")}return await l.json()},onSuccess:()=>{M.invalidateQueries({queryKey:["/api/vecinos/partner-info"]}),x({title:"Información actualizada",description:"Tus datos han sido actualizados correctamente"})},onError:a=>{x({title:"Error al actualizar información",description:a.message,variant:"destructive"})}}),P=S({mutationFn:async a=>{const l=await y("PATCH","/api/vecinos/account/password",{currentPassword:a.currentPassword,newPassword:a.newPassword});if(!l.ok){const v=await l.json();throw new Error(v.message||"Error al actualizar contraseña")}return await l.json()},onSuccess:()=>{f.reset({currentPassword:"",newPassword:"",confirmPassword:""}),x({title:"Contraseña actualizada",description:"Tu contraseña ha sido actualizada correctamente"})},onError:a=>{x({title:"Error al actualizar contraseña",description:a.message,variant:"destructive"})}}),k=S({mutationFn:async a=>{const l=await y("PATCH","/api/vecinos/account/bank",a);if(!l.ok){const v=await l.json();throw new Error(v.message||"Error al actualizar información bancaria")}return await l.json()},onSuccess:()=>{M.invalidateQueries({queryKey:["/api/vecinos/partner-info"]}),x({title:"Información bancaria actualizada",description:"Tus datos bancarios han sido actualizados correctamente"})},onError:a=>{x({title:"Error al actualizar información bancaria",description:a.message,variant:"destructive"})}}),ee=a=>{C.mutate(a)},ae=a=>{P.mutate(a)},se=a=>{k.mutate(a)};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-blue-600 text-white",children:e.jsx("div",{className:"container mx-auto px-4 py-4 flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs(h,{variant:"ghost",className:"text-white hover:bg-blue-700 mr-2",onClick:()=>w("/vecinos/dashboard"),children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Volver"]}),e.jsx("h1",{className:"text-xl font-bold",children:"Mi Cuenta"})]})})}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:Z?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-blue-600 border-t-transparent rounded-full"})}):s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8 flex flex-col sm:flex-row items-center gap-6",children:[e.jsx(oe,{className:"h-24 w-24",children:s.avatarUrl?e.jsx(ie,{src:s.avatarUrl,alt:s.storeName}):e.jsx(ce,{className:"bg-blue-100 text-blue-600 text-2xl",children:((K=s.storeName)==null?void 0:K.substring(0,2).toUpperCase())||"VX"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:s.storeName}),e.jsx("p",{className:"text-gray-600",children:s.ownerName}),e.jsxs("div",{className:"flex mt-2",children:[e.jsxs(X,{variant:"outline",className:"mr-2",children:["ID: ",s.id]}),e.jsxs(X,{className:"bg-blue-100 text-blue-800 hover:bg-blue-100",children:[s.commissionRate,"% comisión"]})]})]})]}),e.jsxs(le,{defaultValue:"general",value:W,onValueChange:Y,children:[e.jsxs(de,{className:"grid grid-cols-3 mb-8",children:[e.jsx(T,{value:"general",children:"Información general"}),e.jsx(T,{value:"password",children:"Contraseña"}),e.jsx(T,{value:"bank",children:"Datos bancarios"})]}),e.jsx(z,{value:"general",children:e.jsxs(I,{children:[e.jsxs(A,{children:[e.jsx(F,{children:"Información general"}),e.jsx(q,{children:"Actualiza la información de tu negocio"})]}),e.jsx(B,{children:e.jsx(L,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(ee),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(r,{control:m.control,name:"storeName",render:({field:a})=>e.jsxs(n,{children:[e.jsx(t,{children:"Nombre del negocio"}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(me,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx(d,{...a})]})}),e.jsx(i,{})]})}),e.jsx(r,{control:m.control,name:"ownerName",render:({field:a})=>e.jsxs(n,{children:[e.jsx(t,{children:"Nombre del propietario"}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx(d,{...a})]})}),e.jsx(i,{})]})}),e.jsx(r,{control:m.control,name:"email",render:({field:a})=>e.jsxs(n,{children:[e.jsx(t,{children:"Correo electrónico"}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(xe,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx(d,{...a})]})}),e.jsx(i,{})]})}),e.jsx(r,{control:m.control,name:"phone",render:({field:a})=>e.jsxs(n,{children:[e.jsx(t,{children:"Teléfono"}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(he,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx(d,{...a})]})}),e.jsx(i,{})]})}),e.jsx(r,{control:m.control,name:"address",render:({field:a})=>e.jsxs(n,{children:[e.jsx(t,{children:"Dirección"}),e.jsx(o,{children:e.jsx(d,{...a})}),e.jsx(i,{})]})}),e.jsx(r,{control:m.control,name:"city",render:({field:a})=>e.jsxs(n,{children:[e.jsx(t,{children:"Ciudad"}),e.jsx(o,{children:e.jsx(d,{...a})}),e.jsx(i,{})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(h,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",disabled:C.isPending,children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),C.isPending?"Guardando...":"Guardar cambios"]})})]})})})]})}),e.jsx(z,{value:"password",children:e.jsxs(I,{children:[e.jsxs(A,{children:[e.jsx(F,{children:"Cambiar contraseña"}),e.jsx(q,{children:"Actualiza tu contraseña para mantener tu cuenta segura"})]}),e.jsx(B,{children:e.jsx(L,{...f,children:e.jsxs("form",{onSubmit:f.handleSubmit(ae),className:"space-y-6",children:[e.jsx(r,{control:f.control,name:"currentPassword",render:({field:a})=>e.jsxs(n,{children:[e.jsx(t,{children:"Contraseña actual"}),e.jsx(o,{children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx(d,{type:j?"text":"password",...a})]}),e.jsx(h,{type:"button",variant:"ghost",size:"icon",className:"absolute right-1 top-1/2 -translate-y-1/2 h-8 w-8",onClick:()=>N(!j),children:j?e.jsx(O,{className:"h-4 w-4"}):e.jsx(Q,{className:"h-4 w-4"})})]})}),e.jsx(i,{})]})}),e.jsx(je,{}),e.jsx(r,{control:f.control,name:"newPassword",render:({field:a})=>e.jsxs(n,{children:[e.jsx(t,{children:"Nueva contraseña"}),e.jsx(o,{children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx(d,{type:b?"text":"password",...a})]}),e.jsx(h,{type:"button",variant:"ghost",size:"icon",className:"absolute right-1 top-1/2 -translate-y-1/2 h-8 w-8",onClick:()=>J(!b),children:b?e.jsx(O,{className:"h-4 w-4"}):e.jsx(Q,{className:"h-4 w-4"})})]})}),e.jsx(i,{})]})}),e.jsx(r,{control:f.control,name:"confirmPassword",render:({field:a})=>e.jsxs(n,{children:[e.jsx(t,{children:"Confirmar nueva contraseña"}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx(d,{type:b?"text":"password",...a})]})}),e.jsx(i,{})]})}),e.jsxs(D,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx($,{className:"h-4 w-4 text-yellow-600"}),e.jsx(V,{className:"text-yellow-600",children:"Importante"}),e.jsx(G,{children:"Tu contraseña debe tener al menos 8 caracteres y contener letras y números para mayor seguridad."})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(h,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",disabled:P.isPending,children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),P.isPending?"Actualizando...":"Actualizar contraseña"]})})]})})})]})}),e.jsx(z,{value:"bank",children:e.jsxs(I,{children:[e.jsxs(A,{children:[e.jsx(F,{children:"Datos bancarios"}),e.jsx(q,{children:"Esta información se utilizará para transferir tus comisiones"})]}),e.jsx(B,{children:e.jsx(L,{...u,children:e.jsxs("form",{onSubmit:u.handleSubmit(se),className:"space-y-6",children:[e.jsx(r,{control:u.control,name:"bankName",render:({field:a})=>e.jsxs(n,{children:[e.jsx(t,{children:"Banco"}),e.jsx(o,{children:e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",...a,children:[e.jsx("option",{value:"",children:"Seleccionar banco"}),e.jsx("option",{value:"banco_estado",children:"Banco Estado"}),e.jsx("option",{value:"banco_santander",children:"Banco Santander"}),e.jsx("option",{value:"banco_chile",children:"Banco de Chile"}),e.jsx("option",{value:"banco_bci",children:"Banco BCI"}),e.jsx("option",{value:"banco_scotiabank",children:"Scotiabank"}),e.jsx("option",{value:"otro",children:"Otro"})]})}),e.jsx(i,{})]})}),e.jsx(r,{control:u.control,name:"accountType",render:({field:a})=>e.jsxs(n,{children:[e.jsx(t,{children:"Tipo de cuenta"}),e.jsx(o,{children:e.jsxs("select",{className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",...a,children:[e.jsx("option",{value:"",children:"Seleccionar tipo de cuenta"}),e.jsx("option",{value:"cuenta_corriente",children:"Cuenta Corriente"}),e.jsx("option",{value:"cuenta_vista",children:"Cuenta Vista / RUT"}),e.jsx("option",{value:"cuenta_ahorro",children:"Cuenta de Ahorro"})]})}),e.jsx(i,{})]})}),e.jsx(r,{control:u.control,name:"accountNumber",render:({field:a})=>e.jsxs(n,{children:[e.jsx(t,{children:"Número de cuenta"}),e.jsx(o,{children:e.jsx(d,{...a})}),e.jsx(i,{})]})}),e.jsx(r,{control:u.control,name:"ownerRut",render:({field:a})=>e.jsxs(n,{children:[e.jsx(t,{children:"RUT del titular"}),e.jsx(o,{children:e.jsx(d,{placeholder:"Ej. 12345678-9",...a})}),e.jsx(i,{})]})}),e.jsxs(D,{className:"bg-blue-50 border-blue-200",children:[e.jsx(be,{className:"h-4 w-4 text-blue-600"}),e.jsx(V,{className:"text-blue-600",children:"Información importante"}),e.jsx(G,{children:"Los datos bancarios son necesarios para recibir el pago de tus comisiones. Asegúrate de que la información sea correcta."})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(h,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",disabled:k.isPending,children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),k.isPending?"Guardando...":"Guardar datos bancarios"]})})]})})})]})})]})]}):e.jsxs(D,{variant:"destructive",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx(V,{children:"Error"}),e.jsxs(G,{children:["No se pudo cargar la información de la cuenta. Por favor, intenta nuevamente.",e.jsx(h,{variant:"link",className:"p-0 h-auto text-red-600 hover:text-red-700 underline",onClick:()=>M.invalidateQueries({queryKey:["/api/vecinos/partner-info"]}),children:"Reintentar"})]})]})})})]})}function X({children:p,variant:w,className:j}){const N="text-xs font-medium px-2.5 py-0.5 rounded-full whitespace-nowrap",b=w==="outline"?`${N} border border-gray-300 text-gray-600 ${j||""}`:`${N} ${j||""}`;return e.jsx("span",{className:b,children:p})}export{Ne as default};
